const t=document,e={items:[],current:null,parent:null,maxHeight:0,proposal:"Add {X} to the list?",sort:!0,order:"desc",removalIcon:"&times;",placeHolder:"Type to search",onDelete:null,onCreate:null};export default class{constructor(t,s={}){this.options=Object.assign({},e,s),this.dom={el:this._setElement(t)},this.options.items=this._convertItems(s.items),this.current=s.current?this._convertItem(s.current):{},this.__found=null,this.options.sort&&this._sortItems(),this._renderInit(),this._events=[],this._bindEvents()}_bindEvents(){let e=t=>{"Escape"!==t.key&&27!==t.keyCode&&this.dom.el.contains(t.target)||this.toggle(!1)};this.on("input",this._search),this.on("click",this._handleClick),this.on("keyup",this._handleKey),this.on("focusin",()=>this._renderListItems().toggle(!0),this.dom.input),this.on("keyup",e,t),this.on("click",e,t)}on(t,e,s=null){return(s||this.dom.el).addEventListener(t,e=e.bind(this),!0),this._events.push({name:t,fn:e,el:s}),this}onDelete(t){return this.options.onDelete=t,this}onCreate(t){return this.options.onCreate=t,this}toggle(t=!1){return this.dom.el.firstElementChild.classList[t?"remove":"add"]("si-hide"),t||this.dom.input.blur(),this}getElement(){return this.dom.el}getItems(){return this.options.items}getCurrent(){let t=Object.assign({},this.current);return delete t._lc,t}clearCurrent(){this.current={},this.dom.input.value="",this._clearSelected()}findItem(t){return t=t.nodeName?t.dataset.value:t,this.options.items.find(e=>e.value===t)}remove(){this._events=this._events.filter(t=>(t.el||this.dom.el).removeEventListener(t.name,t.fn,!0)),this.dom.el.parentNode.removeChild(this.dom.el),this.dom=this.options=null}_setCurrent(t,e=null){return this.current=t,this.dom.input.value=t.value.toString(),this._setSelected(t,e),this}_trigger(e,s=null){let i;"function"==typeof CustomEvent?i=new CustomEvent(e,{detail:s||this.current}):(i=t.createEvent("Event")).initEvent(e,!0,!0),this.dom.el.dispatchEvent(i)}_setElement(e){if(!e&&!e.nodeType&&"string"!=typeof e)throw new Error("Wrong element type provided!");return e.nodeType?e:(this.options.parent||t).querySelector(e)}_setSelected(t,e=null){this._clearSelected(),(e=e||this.dom.list.querySelector(`li[data-value="${t.value}"]`))&&e.classList.add("si-current")}_clearSelected(){let t=this.dom.list.querySelector(".si-current");t&&t.classList.remove("si-current")}_convertItems(t=[]){return t.map(t=>this._convertItem(t))}_convertItem(t){return(t="object"!=typeof t?{value:t}:t)._lc=t.value.toString().toLowerCase(),t}_renderInit(){let e=t.createElement("div");return e.className="si-wrap si-hide",this.dom.input=e.appendChild(this._renderInput()).firstChild,this.dom.list=e.appendChild(this._renderList()).firstChild,this.current.value&&(this.dom.input.value=this.current.value),this.dom.el.appendChild(e)}_renderInput(){let e=t.createElement("div"),s=t.createElement("input");return e.className="si-input",s.type="text",s.autocomplete="false",s.spellcheck=!1,s.placeholder=this.options.placeHolder,e.appendChild(s),e}_renderList(){let e=t.createElement("div"),s=t.createElement("ul"),i=this.options.maxHeight;return e.className="si-list",i&&(e.style.maxHeight=i+"px"),e.appendChild(s),e}_createListItems(t=[]){let e="",s=this.current.value,i="",r=this._createRemovalButton();return t.forEach(t=>{i=s&&t.value===s?" si-current":"",e+=`<li class="si-item${i}" data-value="${t.value}">${t.value}${r}</li>`}),e}_renderListItems(t=""){return this.dom.list.innerHTML=t||this._createListItems(this.options.items),this}_createRemovalButton(){return`<button type="button" class="si-removal">${this.options.removalIcon}</button>`}_search(t){let e=null,s=t.target.value,i=s.toLowerCase(),r=this.options.items.filter(t=>-1!==t._lc.indexOf(i)),n=this._createListItems(r),l=r[0],o=r.length;1===o&&l&&(e=l),(!l||o&&i&&i!==l._lc)&&(n+=this._proposeItem(s)),this.__found=e,this._renderListItems(n)}_proposeItem(t){return`<li class="si-item si-proposal" data-term="${t}">${this.options.proposal.replace("{X}",`<span>${t}</span>`)}</li>`}_handleClick(t){let e=t.target,s=e.classList;if(s.contains("si-proposal")){let t=this._convertItem(e.dataset.term);this._fireCallback("onCreate",t)&&this._setCurrent(this._insertItem(t),e).toggle()._trigger("created")}else s.contains("si-item")?this._setCurrent(this.findItem(e),e).toggle()._trigger("selected"):s.contains("si-removal")&&(e=e.parentNode,this._fireCallback("onDelete",this.findItem(e))&&this._trigger("removed",this._sliceItem(e)))}_fireCallback(t,e){return"function"!=typeof this.options[t]||this.options[t](e)}_handleKey(t){let e,s=t.target.value,i=this.__found;s&&13!==t.keyCode&&"Enter"!==t.key||(!i&&s?(i=this._convertItem(s),!this.findItem(s)&&this._fireCallback("onCreate",i)&&(e="created",this._setCurrent(this._insertItem(i)))):i&&(e="selected",this._setCurrent(i)),e&&this.toggle()._trigger(e))}_insertItem(t){return this.options.items.push(t),this.options.sort&&this._sortItems(),t}_sortItems(){let t="desc"===this.options.order?1:-1;this.options.items.sort((e,s)=>e._lc<s._lc?-t:e._lc>s._lc?t:0)}_sliceItem(t){let e,s=this.options.items,i=t.dataset.value.toLowerCase(),r=this.current;return this.dom.list.removeChild(t),e=s.splice(s.findIndex(t=>t._lc===i),1).shift(),r&&e._lc===r._lc&&this.clearCurrent(),e}}
//# sourceMappingURL=select-input-min.js.map
