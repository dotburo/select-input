/*! @dotburo/select-input 1.3.2 | dotburo <code@dotburo.org> (https://dotburo.org) !*/
const t=document;var e={parent:null,items:[],current:null,allowAdd:!0,proposal:"Add {X} to the list?",notFound:"{X} is not in the list",allowRemove:!0,removalIcon:"&times;",placeHolder:"Type to search",sort:!0,order:"desc",maxHeight:0,onDelete:null,onCreate:null,valueKey:"value",textKey:"value"};const s=document;export default class extends class{constructor(t,e={},s={}){this.options=Object.assign({},s,e),this._events=[],this.dom={el:this._setElement(t)}}on(t,e,s=null){return(s||this.dom.el).addEventListener(t,e=e.bind(this),!0),this._events.push({name:t,fn:e,el:s}),this}getElement(){return this.dom.el}remove(){this._events=this._events.filter(t=>(t.el||this.dom.el).removeEventListener(t.name,t.fn,!0)),this.dom.el.parentNode.removeChild(this.dom.el),this.dom=this.options=null}_setElement(e){if(!e&&!e.nodeType&&"string"!=typeof e)throw new Error("Wrong element type provided!");return e.nodeType?e:(this.options.parent||t).querySelector(e)}_trigger(e,s=null){let i;"function"==typeof CustomEvent?i=new CustomEvent(e,{detail:s,bubbles:!0,cancelable:!0}):(i=t.createEvent("Event"),i.initEvent(e,!0,!0)),this.dom.el.dispatchEvent(i)}}{constructor(t,s={}){super(t,s,e);let i=s.current?this._convertItem(s.current):null;this.options.items=this._convertItems(s.items),this.current=i?this.findItem(this._getItemProp(i)):null,this.__found=null,this.options.sort&&this._sortItems(),this._renderInit(),this._bindEvents(),i&&this._setInputValue(i)}_bindEvents(){let t=t=>{"Escape"!==t.key&&27!==t.keyCode&&this.dom.el.contains(t.target)||this.toggle(!1)};this.on("input",this._search),this.on("click",this._handleClick),this.on("keyup",this._handleKey),this.on("focusin",()=>this._renderListItems().toggle(!0),this.dom.input),this.on("keyup",t,s),this.on("click",t,s)}onDelete(t){return this.options.onDelete=t,this}onCreate(t){return this.options.onCreate=t,this}toggle(t=!1){return this.dom.el.firstElementChild.classList[t?"remove":"add"]("si-hide"),t||this.dom.input.blur(),this}getItems(){return this.options.items}getCurrent(){let t=Object.assign({},this.current);return delete t._lc_value,delete t._lc_text,t}clearCurrent(){this.current=null,this.dom.input.value="",this._clearSelected()}findItem(t){return t=t.nodeName?t.dataset.value:t,this.options.items.find(e=>this._getItemProp(e)==t)}setCurrent(t){return this._setCurrent(t?this.findItem(t):null),this}_setCurrent(t,e=null){return this._setInputValue(t),t?(this.current=t,this._setSelected(t,e)):(this.current=null,this._clearSelected()),this}_setInputValue(t){this.dom.input.value=t?this._getItemProp(t,"text").toString():""}_setSelected(t,e=null){this._clearSelected(),(e=e||this.dom.list.querySelector(`li[data-value="${this._getItemProp(t)}"]`))&&e.classList.add("si-current")}_clearSelected(){let t=this.dom.list.querySelector(".si-current");t&&t.classList.remove("si-current")}_convertItems(t=[]){return t.map(t=>this._convertItem(t))}_convertItem(t){let e=this.options;return(t="object"!=typeof t?{[e.valueKey]:t,[e.textKey]:t}:t)._lc_value=this._makeSearchString(this._getItemProp(t)),t._lc_text=this._makeSearchString(this._getItemProp(t,"text")),t}_makeSearchString(t){return t.toString().toLowerCase().replace(/\s+/g,"-")}_getItemProp(t,e="value"){return t?t[this.options[`${e}Key`]]:null}_renderInit(){let t=s.createElement("div");return t.className="si-wrap si-hide",this.dom.input=t.appendChild(this._renderInput()).firstChild,this.dom.list=t.appendChild(this._renderList()).firstChild,this.dom.el.appendChild(t)}_renderInput(){let t=s.createElement("div"),e=s.createElement("input");return t.className="si-input",e.type="text",e.autocomplete="false",e.spellcheck=!1,e.placeholder=this.options.placeHolder,t.appendChild(e),t}_renderList(){let t=s.createElement("div"),e=s.createElement("ul"),i=this.options.maxHeight;return t.className="si-list",i&&(t.style.maxHeight=i+"px"),t.appendChild(e),t}_createListItems(t=[]){let e="",s=this.options,i=this._getItemProp(this.current),r="",n=s.allowRemove?this._createRemovalButton():"",l="",o="";return t.forEach(t=>{l=this._getItemProp(t),o=this._getItemProp(t,"text"),r=i&&l==i?" si-current":"",e+=`<li class="si-item${r}" data-value="${l}">${o+n}</li>`}),e}_renderListItems(t=""){return this.dom.list.innerHTML=t||this._createListItems(this.options.items),this}_createRemovalButton(){return`<button type="button" class="si-removal">${this.options.removalIcon}</button>`}_search(t){let e=this.options,s=t.target.value,i=this._makeSearchString(s),r=this._searchItem(i),n=r||e.allowAdd?this._createListItems(r):"",l=r[0],o=r.length;1===o&&(this.__found=l),1===o&&s||(this.__found=null),e.allowAdd&&s&&(!l||i!==l._lc_text&&i!==l._lc_value)?n+=this._proposeItem(s):e.allowAdd||(n+=this._notFoundItem(s)),this._renderListItems(n)}_searchItem(t){return this.options.items.filter(e=>-1!==e._lc_value.indexOf(t)||-1!==e._lc_text.indexOf(t))}_proposeItem(t){return`<li class="si-item si-append si-proposal" data-term="${t}">${this.options.proposal.replace("{X}",`<span>${t}</span>`)}</li>`}_notFoundItem(t){return`<li class="si-item si-append si-not-found">${this.options.notFound.replace("{X}",`<span>${t}</span>`)}</li>`}_handleClick(t){let e=t.target,s=e.classList;this.options.allowAdd&&s.contains("si-proposal")?this._tryCreateItem(e.dataset.term)&&this.toggle()._trigger("created",this.current):s.contains("si-item")?this._setCurrent(this.findItem(e),e).toggle()._trigger("selected",this.current):this.options.allowRemove&&s.contains("si-removal")&&(e=e.parentNode,this._fireCallback("onDelete",this.findItem(e))&&this._trigger("removed",this._sliceItem(e)))}_fireCallback(t,e){return"function"!=typeof this.options[t]||this.options[t](e)}_handleKey(t){let e,s=t.target.value,i=this.__found;(!s||13===t.keyCode&&"Enter"===t.key)&&(!i&&s&&this.options.allowAdd?e=this._tryCreateItem(s)?"created":null:i&&(e="selected",this._setCurrent(i)),e&&this.toggle()._trigger(e,this.current))}_tryCreateItem(t){let e=this._convertItem(t.trim());return!(this.findItem(t)||!this._fireCallback("onCreate",e))&&(this._setCurrent(this._insertItem(e)),!0)}_insertItem(t){return this.options.items.push(t),this.options.sort&&this._sortItems(),t}_sortItems(){let t="desc"===this.options.order?1:-1;this.options.items.sort((e,s)=>e._lc_text<s._lc_text?-t:e._lc_text>s._lc_text?t:0)}_sliceItem(t){let e,s=this.options.items,i=t.dataset.value.toLowerCase(),r=this.current;return this.dom.list.removeChild(t),e=s.splice(s.findIndex(t=>t._lc_value===i),1).shift(),r&&e._lc_value===r._lc_value&&this.clearCurrent(),e}}
//# sourceMappingURL=select-input-min.js.map
